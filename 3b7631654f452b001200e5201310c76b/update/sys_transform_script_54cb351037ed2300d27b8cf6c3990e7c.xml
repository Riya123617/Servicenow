<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_transform_script">
    <sys_transform_script action="INSERT_OR_UPDATE">
        <active>true</active>
        <map display_value="Nutanix Calm Application - Map">a3243fc637c12300d27b8cf6c3990e6b</map>
        <order>100</order>
        <script><![CDATA[(function runTransformScript(source, map, log, target /*undefined onStart*/ ) {

    // Add your code here
    var logger = new Nutanix_Calm_Logger();
    logger.info("Transform map [" + map.name + "]. completed.");

    if (gs.getProperty("x_nuta2_nutanix_ca.var_migrate") + "" == "0") {
        new Migration_Script().copyFieldJson();
        gs.setProperty("x_nuta2_nutanix_ca.var_migrate", "1");
    }

	var gr = new GlideRecord('x_nuta2_nutanix_ca_catalog_variables_properties');
	gr.addQuery('isprofilevariable', 'true');
	gr.addQuery()
	gr.query();
	while (gr.next()) {
		var field_json = gr.field_json;
		var array = field_json.split("}@@");
		var profile = gr.application_profile+"";
		var temp = "";
		var index = 0;

		for (var i = 0; i < (array.length - 1); i++) {

			if (array[i].endsWith(profile) ) {
					temp = temp + array[i] + "}@@";
			} else {
				temp = temp + array[i] + "_" + profile + "}@@";
			
			}
			index++;
		}
		temp = temp + array[index];
		gr.field_json = temp ;
		gr.update();
	}
	
	//scope for improment marge in above loop
	var name_gr = new GlideRecord('x_nuta2_nutanix_ca_catalog_variables_properties');
	name_gr.addEncodedQuery('isprofilevariable=true');
	name_gr.query();
	while(name_gr.next()){
			var field_json = JSON.parse(name_gr.field_json);
			var name = field_json.name+'';
			if(name.includes("_"+name_gr.application_profile)){
				continue;
			}else{
				name = name+"_"+name_gr.application_profile;
				field_json.name = name ;
				name_gr.field_json = JSON.stringify(field_json);
				name_gr.update();
			}
	}
})(source, map, log, target);]]></script>
        <sys_class_name>sys_transform_script</sys_class_name>
        <sys_created_by>mumtaz.ansari</sys_created_by>
        <sys_created_on>2018-10-30 11:49:58</sys_created_on>
        <sys_id>54cb351037ed2300d27b8cf6c3990e7c</sys_id>
        <sys_mod_count>24</sys_mod_count>
        <sys_name>onComplete</sys_name>
        <sys_package display_value="Nutanix Calm" source="x_nuta2_nutanix_ca">3b7631654f452b001200e5201310c76b</sys_package>
        <sys_policy>protected</sys_policy>
        <sys_scope display_value="Nutanix Calm">3b7631654f452b001200e5201310c76b</sys_scope>
        <sys_update_name>sys_transform_script_54cb351037ed2300d27b8cf6c3990e7c</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-04-21 10:53:33</sys_updated_on>
        <when>onComplete</when>
    </sys_transform_script>
</record_update>
